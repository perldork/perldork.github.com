<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Development | Semintelligent - Max Schubert]]></title>
  <link href="http://perldork.github.io/blog/categories/development/atom.xml" rel="self"/>
  <link href="http://perldork.github.io/"/>
  <updated>2014-02-27T20:43:06-05:00</updated>
  <id>http://perldork.github.io/</id>
  <author>
    <name><![CDATA[Max Schubert]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[When Writing Rspec Tests 15 Pieces of Flair Is Perfect Just Ignore Brian]]></title>
    <link href="http://perldork.github.io/blog/2014/02/27/when-writing-rspec-tests-15-pieces-of-flair-is-perfect-just-ignore-brian/"/>
    <updated>2014-02-27T19:59:49-05:00</updated>
    <id>http://perldork.github.io/blog/2014/02/27/when-writing-rspec-tests-15-pieces-of-flair-is-perfect-just-ignore-brian</id>
    <content type="html"><![CDATA[<p><blockquote><p>Stan, Chotchkie&rsquo;s Manager: Now, you know it&rsquo;s up to you whether or not<br/>you want to just do the bare minimum. Or&hellip; well, like Brian, for<br/>example, has thirty seven pieces of flair, okay. And a terrific smile.</p><footer><strong>Office Space</strong></footer></blockquote></p>

<p>Forget Brian, when it comes to writing rspec tests let your lazy come
out.  Do the minimum.  Write a test that just does enough to prove
that your feature or component behaves as expected.</p>

<h3>Do</h3>

<ul>
<li>Test all known user story / requirement business paths ( &ldquo;happy paths&rdquo; )
related to the component or feature.</li>
<li>Write a test that really exercises them with real data ( not mocks
unless you have no other choice but to use mocks ).</li>
<li>Write it so it both proves your code does what it is supposed to do
and so that it teaches other developers looking at it how that part of
the application or component should behave</li>
</ul>


<h3>Don&rsquo;t</h3>

<ul>
<li>Write a placeholder or filler test just so you can say you have test
coverage</li>
<li>Validate every single attribute or piece of data related to the test;
that makes your test very tightly coupled to the implementation and
means that any tiny change to the code requires the test to be updated
as well.  This makes developers hate you and your overly high-maintenance tests.</li>
<li>Be obscure nor clever.  Make the test direct and simple &ndash; the way we&rsquo;d
all like our English to be!</li>
<li>Use mocks unless you absolutely need to.  Why?  Mocks quickly become
lies &ndash; if they are flexible enough to take made up method names they are
likely to continue to take that made up method name even when the real
implementation changes. Now your test lies to everyone when it says
it passes because what it tests is something that is not used in the real
implementation.  The only place I personally feel comfortable with
mocks is when external network-based services are dependencies and
having them reliably be available in development and test environments
is not possible.</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[HOW-TO: Rack::Attack With Dalli and Padrino]]></title>
    <link href="http://perldork.github.io/blog/2014/02/25/how-to-rack-attack-with-dalli-and-padrino/"/>
    <updated>2014-02-25T23:24:42-05:00</updated>
    <id>http://perldork.github.io/blog/2014/02/25/how-to-rack-attack-with-dalli-and-padrino</id>
    <content type="html"><![CDATA[<p>We use <a href="https://github.com/mperham/dalli">Dalli</a> for memcached-based route caching with
<a href="http://www.padrinorb.com/">Padrino</a> 0.12. I wanted to add rate throttling for all /api
route handlers to our app and wanted to use Dalli for that as well.</p>

<p>I found <a href="https://github.com/kickstarter/rack-attack">Rack::Attack</a>, a
really nice Rack-based gem that allows for connection throttling,
blacklisting and whitelisting of clients.  Cool stuff, perfect for our
needs.  Except it expects the caching layer to conform to the
ActiveSupport::Cache::Store interface:</p>

<p><blockquote><p>Note that Rack::Attack.cache is only used for throttling; not<br/>blacklisting &amp; whitelisting. Your cache store must implement increment<br/>and write like ActiveSupport::Cache::Store.</p></blockquote></p>

<p>Darn!  Oh, wait, not so bad.  But I don&rsquo;t want to have to do inline
creation of the client etc in app/app.rb, especially because I&rsquo;m likely
to have different throttling requirements for different environments.</p>

<h3>Modules and blocks to the rescue!</h3>

<ol>
<li>Create a subclass for the Dalli client that conforms to the ActiveSupport API.</li>
<li>Create a helper method that can be used inline in app/app.rb that
takes a block with an environment-specific policy.</li>
<li>Wrap the use and cache client creation so it doesn&rsquo;t have to be
repeated in app/app.rb</li>
</ol>


<h5>Our security mixin module with configure_security helper</h5>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>lib/security.rb </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;module Security&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span>  <span class="nb">require</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">dalli</span><span class="o">/</span><span class="n">client</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;  @@store = nil&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span>  <span class="c1"># Dalli client does not conform to cache client</span>
</span><span class='line'>  <span class="c1"># interface Rack::Attack expects &amp;ndash; so add wrappers</span>
</span><span class='line'>  <span class="c1"># for methods.&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span>  <span class="k">class</span> <span class="nc">MemStore</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="ss">Dalli</span><span class="p">:</span><span class="ss">:Client</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;pre&gt;&lt;code&gt;def decrement( key, step, options )</span>
</span><span class='line'><span class="sr">  decr( key, step, options[ :expires_in ] )</span>
</span><span class='line'><span class="sr">end</span>
</span><span class='line'><span class="sr">def increment( key, step, options )</span>
</span><span class='line'><span class="sr">  incr( key, step, options[ :expires_in ], nil )</span>
</span><span class='line'><span class="sr">end</span>
</span><span class='line'><span class="sr">def write( key, value, options )</span>
</span><span class='line'><span class="sr">  # Have to use raw =&amp;gt; true for write or we get marshall</span>
</span><span class='line'><span class="sr">  # errors as Dalli marshals the Fixnum object instead of</span>
</span><span class='line'><span class="sr">  # sending the raw integer value</span>
</span><span class='line'><span class="sr">  set( key, value, options[ :expires_in ], :raw =&amp;gt; true )</span>
</span><span class='line'><span class="sr">end</span>
</span><span class='line'><span class="sr">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;</span><span class="sr">/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;  end&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span>  <span class="k">def</span> <span class="nf">initialize_store</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;pre&gt;&lt;code&gt;if @@store.nil?</span>
</span><span class='line'><span class="sr">  use Rack::Attack</span>
</span><span class='line'><span class="sr">  @@store = Rack::Attack.cache.store = MemStore.new %{localhost:11211}</span>
</span><span class='line'><span class="sr">end</span>
</span><span class='line'><span class="sr">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;</span><span class="sr">/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;  end&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span>  <span class="c1"># Called from app/app.rb</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">configure_security</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;pre&gt;&lt;code&gt;initialize_store</span>
</span><span class='line'><span class="sr">yield( Rack::Attack )</span>
</span><span class='line'><span class="sr">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;</span><span class="sr">/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;  end&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="k">end</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h5>Now use it in app/app.rb</h5>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>app/app.rb </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;pre&gt;&lt;code&gt;self.extend Security # lib/se</span><span class="n">curity</span><span class="o">.</span><span class="n">rb</span> <span class="o">-</span> <span class="n">adds</span> <span class="n">configure_security</span> <span class="nb">method</span>
</span><span class='line'>
</span><span class='line'><span class="n">configure</span> <span class="ss">:demo</span><span class="p">,</span> <span class="ss">:development</span><span class="p">,</span> <span class="ss">:api</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Rate limit calls to /api URLs to 2 a second in all envs.</span>
</span><span class='line'>  <span class="n">configure_security</span> <span class="k">do</span> <span class="o">|</span><span class="n">client</span><span class="o">|</span>
</span><span class='line'>    <span class="n">client</span><span class="o">.</span><span class="n">throttle</span><span class="p">(</span><span class="s1">&#39;req/ip&#39;</span><span class="p">,</span> <span class="ss">:limit</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">2</span><span class="p">,</span> <span class="ss">:period</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">1</span><span class="o">.</span><span class="n">second</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">req</span><span class="o">|</span>
</span><span class='line'>      <span class="c1"># If we return false nothing is cached ( no rate limiting )</span>
</span><span class='line'>      <span class="c1"># - only rate limit calls to /api URLs</span>
</span><span class='line'>      <span class="n">req</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">index</span><span class="p">(</span> <span class="sx">%{/api}</span> <span class="p">)</span><span class="o">.</span><span class="n">nil?</span> <span class="p">?</span> <span class="kp">false</span> <span class="p">:</span> <span class="n">req</span><span class="o">.</span><span class="n">ip</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/code&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Hints and Tips for Java Developers New to Ruby]]></title>
    <link href="http://perldork.github.io/blog/2014/02/24/hints-and-advice-for-java-developers-new-to-ruby/"/>
    <updated>2014-02-24T22:48:02-05:00</updated>
    <id>http://perldork.github.io/blog/2014/02/24/hints-and-advice-for-java-developers-new-to-ruby</id>
    <content type="html"><![CDATA[<p>Most java developers have a really solid grasp of object-oriented
concepts and patterns, which makes the transition to ruby easy really easy
from that perspective.  Moving from a statically typed to dynamic
language is still a big change and some of the more basic coding practices
change significantly.  Here are some recommendations I&rsquo;ve come up with
based on my experiences doing mentoring with a bunch of java developers
transitioning to ruby on our team and some code patterns I&rsquo;ve heard used
by a colleague of mine who is also mentoring some java developers who
are transitioning to ruby.</p>

<h3>Hints</h3>

<ul>
<li>Minimize the use of class variables &ndash; ruby&rsquo;s class variables have some
strange inheritence rules, and, with multi-process web containers,
they don&rsquo;t act as singletons across all instances of an app on the
same server anyway.</li>
<li>Prefer local variables over instance variables when possible.
Minimizing the scope of a variable in a dynamic language reduces the
possibility of bugs and makes it much easier to see where the variable
is being set and used.</li>
<li>Don&rsquo;t pre-initialize data structures &ndash; no need.  Arrays and hashes are
dynamic and in the vast majority of circumstances pre-sizing them does
not help performance and just leads to more noise in your code.</li>
<li>Snake-case variables .. thing_one and thing_two.</li>
<li>Semi-colons are not needed at the ends of statements ; only use them
when doing single-line method definitions or rare cases where you want
two statements on the same line.</li>
<li>Prefer composition over complex inheritence trees.</li>
<li>Prefer mixins over complex inheritence trees.</li>
</ul>


<h3>Tips</h3>

<ul>
<li>Explore code with irb or <a href="http://pryrepl.org/">Pry</a>. No faster way to
get conversant with ruby than to explore using it from a ruby-based
shell!</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Great Tools for Distributed Teams]]></title>
    <link href="http://perldork.github.io/blog/2014/02/23/great-tools-for-distributed-teams/"/>
    <updated>2014-02-23T18:28:38-05:00</updated>
    <id>http://perldork.github.io/blog/2014/02/23/great-tools-for-distributed-teams</id>
    <content type="html"><![CDATA[<p>Recently at my job our teams have grown to include a number of people
who are not co-located with us.  Here are some of the tools we&rsquo;ve been
using that have helped us develop and design together across locations.</p>

<h3>Social coding</h3>

<ul>
<li><a href="http://gitlab.org/">Gitlab</a> &ndash; Github-like UI on top of git.  Many of
the same features of Github, pretty easy to host internally.</li>
</ul>


<h3>Remote pair programming</h3>

<ul>
<li><a href="http://www.screenhero.com">Screenhero</a> &ndash; by far the best remote
graphical pair-programming tool I&rsquo;ve found &ndash; includes streaming audio
support so we don&rsquo;t have to have Google Hangouts, Skype, or another
audio application open as well.</li>
<li><a href="https://github.com/seejohnrun/haste-server">Hastebin</a> &ndash; a paste bin
tool that runs on node and is easy to set up internally &ndash; fast, low
memory usage, zero maintenance.</li>
</ul>


<h3>Remote design</h3>

<ul>
<li><a href="http://www.asciiflow.com/">ASCII Flow</a> &ndash; java-based, open source
ASCII diagramming tool.  Great for cutting and posting diagrams into
markdown files.  Haven&rsquo;t tried installing it internally yet.</li>
<li><a href="http://etherpad.org/">Etherpad</a> &ndash; near-real time collaborative,
modeless editing tool &ndash; like Google docs, highlights each person&rsquo;s
text in a different color.  Runs on node as well.</li>
</ul>


<h3>Remote communication</h3>

<p>We&rsquo;ve heard a lot about various team-oriented chat tools, for now we&rsquo;ve
been sticking to the basics and so far so good.</p>

<ul>
<li>IRC</li>
<li><a href="http://blast.aim.com/">AIM blast bots</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Avoid Class Variables in Ruby for Web Applications]]></title>
    <link href="http://perldork.github.io/blog/2014/02/23/avoid-class-variables-in-ruby-for-web-applications/"/>
    <updated>2014-02-23T00:00:00-05:00</updated>
    <id>http://perldork.github.io/blog/2014/02/23/avoid-class-variables-in-ruby-for-web-applications</id>
    <content type="html"><![CDATA[<p>When a ruby application runs in a multi-process web container (phusion passenger or puma for example), class variables set in one
instance of the application will not be visible in another instance &ndash; so if you use them be very aware that the setting will purely
apply to the instance of the application in which the variables are set.</p>

<p>If you need to share data across instances of an application, consider using memcache or another host-level data storage mechanism
with a library that makes it easy to get and set data ( like <a href="https://github.com/mperham/dalli">Dalli</a> for ruby ).</p>
]]></content>
  </entry>
  
</feed>
